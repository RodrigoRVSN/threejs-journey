{"ast":null,"code":"import _extends from '@babel/runtime/helpers/esm/extends';\nimport * as React from 'react';\nimport * as THREE from 'three';\nimport { useThree, useFrame } from '@react-three/fiber';\nimport { HorizontalBlurShader, VerticalBlurShader } from 'three-stdlib';\nconst ContactShadows = /*#__PURE__*/React.forwardRef((_ref, ref) => {\n  let {\n    scale = 10,\n    frames = Infinity,\n    opacity = 1,\n    width = 1,\n    height = 1,\n    blur = 1,\n    far = 10,\n    resolution = 512,\n    smooth = true,\n    color = '#000000',\n    depthWrite = false,\n    renderOrder,\n    ...props\n  } = _ref;\n  const scene = useThree(state => state.scene);\n  const gl = useThree(state => state.gl);\n  const shadowCamera = React.useRef(null);\n  width = width * (Array.isArray(scale) ? scale[0] : scale || 1);\n  height = height * (Array.isArray(scale) ? scale[1] : scale || 1);\n  const [renderTarget, planeGeometry, depthMaterial, blurPlane, horizontalBlurMaterial, verticalBlurMaterial, renderTargetBlur] = React.useMemo(() => {\n    const renderTarget = new THREE.WebGLRenderTarget(resolution, resolution);\n    const renderTargetBlur = new THREE.WebGLRenderTarget(resolution, resolution);\n    renderTargetBlur.texture.generateMipmaps = renderTarget.texture.generateMipmaps = false;\n    const planeGeometry = new THREE.PlaneGeometry(width, height).rotateX(Math.PI / 2);\n    const blurPlane = new THREE.Mesh(planeGeometry);\n    const depthMaterial = new THREE.MeshDepthMaterial();\n    depthMaterial.depthTest = depthMaterial.depthWrite = false;\n\n    depthMaterial.onBeforeCompile = shader => {\n      shader.uniforms = { ...shader.uniforms,\n        ucolor: {\n          value: new THREE.Color(color)\n        }\n      };\n      shader.fragmentShader = shader.fragmentShader.replace(`void main() {`, //\n      `uniform vec3 ucolor;\n           void main() {\n          `);\n      shader.fragmentShader = shader.fragmentShader.replace('vec4( vec3( 1.0 - fragCoordZ ), opacity );', // Colorize the shadow, multiply by the falloff so that the center can remain darker\n      'vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );');\n    };\n\n    const horizontalBlurMaterial = new THREE.ShaderMaterial(HorizontalBlurShader);\n    const verticalBlurMaterial = new THREE.ShaderMaterial(VerticalBlurShader);\n    verticalBlurMaterial.depthTest = horizontalBlurMaterial.depthTest = false;\n    return [renderTarget, planeGeometry, depthMaterial, blurPlane, horizontalBlurMaterial, verticalBlurMaterial, renderTargetBlur];\n  }, [resolution, width, height, scale, color]);\n\n  const blurShadows = blur => {\n    blurPlane.visible = true;\n    blurPlane.material = horizontalBlurMaterial;\n    horizontalBlurMaterial.uniforms.tDiffuse.value = renderTarget.texture;\n    horizontalBlurMaterial.uniforms.h.value = blur * 1 / 256;\n    gl.setRenderTarget(renderTargetBlur);\n    gl.render(blurPlane, shadowCamera.current);\n    blurPlane.material = verticalBlurMaterial;\n    verticalBlurMaterial.uniforms.tDiffuse.value = renderTargetBlur.texture;\n    verticalBlurMaterial.uniforms.v.value = blur * 1 / 256;\n    gl.setRenderTarget(renderTarget);\n    gl.render(blurPlane, shadowCamera.current);\n    blurPlane.visible = false;\n  };\n\n  let count = 0;\n  useFrame(() => {\n    if (shadowCamera.current && (frames === Infinity || count < frames)) {\n      const initialBackground = scene.background;\n      scene.background = null;\n      const initialOverrideMaterial = scene.overrideMaterial;\n      scene.overrideMaterial = depthMaterial;\n      gl.setRenderTarget(renderTarget);\n      gl.render(scene, shadowCamera.current);\n      scene.overrideMaterial = initialOverrideMaterial;\n      blurShadows(blur);\n      if (smooth) blurShadows(blur * 0.4);\n      gl.setRenderTarget(null);\n      scene.background = initialBackground;\n      count++;\n    }\n  });\n  return /*#__PURE__*/React.createElement(\"group\", _extends({\n    \"rotation-x\": Math.PI / 2\n  }, props, {\n    ref: ref\n  }), /*#__PURE__*/React.createElement(\"mesh\", {\n    renderOrder: renderOrder,\n    geometry: planeGeometry,\n    scale: [1, -1, 1],\n    rotation: [-Math.PI / 2, 0, 0]\n  }, /*#__PURE__*/React.createElement(\"meshBasicMaterial\", {\n    map: renderTarget.texture,\n    \"map-encoding\": gl.outputEncoding,\n    transparent: true,\n    opacity: opacity,\n    depthWrite: depthWrite\n  })), /*#__PURE__*/React.createElement(\"orthographicCamera\", {\n    ref: shadowCamera,\n    args: [-width / 2, width / 2, height / 2, -height / 2, 0, far]\n  }));\n});\nexport { ContactShadows };","map":{"version":3,"names":["_extends","React","THREE","useThree","useFrame","HorizontalBlurShader","VerticalBlurShader","ContactShadows","forwardRef","ref","scale","frames","Infinity","opacity","width","height","blur","far","resolution","smooth","color","depthWrite","renderOrder","props","scene","state","gl","shadowCamera","useRef","Array","isArray","renderTarget","planeGeometry","depthMaterial","blurPlane","horizontalBlurMaterial","verticalBlurMaterial","renderTargetBlur","useMemo","WebGLRenderTarget","texture","generateMipmaps","PlaneGeometry","rotateX","Math","PI","Mesh","MeshDepthMaterial","depthTest","onBeforeCompile","shader","uniforms","ucolor","value","Color","fragmentShader","replace","ShaderMaterial","blurShadows","visible","material","tDiffuse","h","setRenderTarget","render","current","v","count","initialBackground","background","initialOverrideMaterial","overrideMaterial","createElement","geometry","rotation","map","outputEncoding","transparent","args"],"sources":["/home/rodrigorvsn/workspace/study/threejs-journey/07-react-three-fiber/08-mouse-events-with-r3f/node_modules/@react-three/drei/core/ContactShadows.js"],"sourcesContent":["import _extends from '@babel/runtime/helpers/esm/extends';\nimport * as React from 'react';\nimport * as THREE from 'three';\nimport { useThree, useFrame } from '@react-three/fiber';\nimport { HorizontalBlurShader, VerticalBlurShader } from 'three-stdlib';\n\nconst ContactShadows = /*#__PURE__*/React.forwardRef(({\n  scale = 10,\n  frames = Infinity,\n  opacity = 1,\n  width = 1,\n  height = 1,\n  blur = 1,\n  far = 10,\n  resolution = 512,\n  smooth = true,\n  color = '#000000',\n  depthWrite = false,\n  renderOrder,\n  ...props\n}, ref) => {\n  const scene = useThree(state => state.scene);\n  const gl = useThree(state => state.gl);\n  const shadowCamera = React.useRef(null);\n  width = width * (Array.isArray(scale) ? scale[0] : scale || 1);\n  height = height * (Array.isArray(scale) ? scale[1] : scale || 1);\n  const [renderTarget, planeGeometry, depthMaterial, blurPlane, horizontalBlurMaterial, verticalBlurMaterial, renderTargetBlur] = React.useMemo(() => {\n    const renderTarget = new THREE.WebGLRenderTarget(resolution, resolution);\n    const renderTargetBlur = new THREE.WebGLRenderTarget(resolution, resolution);\n    renderTargetBlur.texture.generateMipmaps = renderTarget.texture.generateMipmaps = false;\n    const planeGeometry = new THREE.PlaneGeometry(width, height).rotateX(Math.PI / 2);\n    const blurPlane = new THREE.Mesh(planeGeometry);\n    const depthMaterial = new THREE.MeshDepthMaterial();\n    depthMaterial.depthTest = depthMaterial.depthWrite = false;\n\n    depthMaterial.onBeforeCompile = shader => {\n      shader.uniforms = { ...shader.uniforms,\n        ucolor: {\n          value: new THREE.Color(color)\n        }\n      };\n      shader.fragmentShader = shader.fragmentShader.replace(`void main() {`, //\n      `uniform vec3 ucolor;\n           void main() {\n          `);\n      shader.fragmentShader = shader.fragmentShader.replace('vec4( vec3( 1.0 - fragCoordZ ), opacity );', // Colorize the shadow, multiply by the falloff so that the center can remain darker\n      'vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );');\n    };\n\n    const horizontalBlurMaterial = new THREE.ShaderMaterial(HorizontalBlurShader);\n    const verticalBlurMaterial = new THREE.ShaderMaterial(VerticalBlurShader);\n    verticalBlurMaterial.depthTest = horizontalBlurMaterial.depthTest = false;\n    return [renderTarget, planeGeometry, depthMaterial, blurPlane, horizontalBlurMaterial, verticalBlurMaterial, renderTargetBlur];\n  }, [resolution, width, height, scale, color]);\n\n  const blurShadows = blur => {\n    blurPlane.visible = true;\n    blurPlane.material = horizontalBlurMaterial;\n    horizontalBlurMaterial.uniforms.tDiffuse.value = renderTarget.texture;\n    horizontalBlurMaterial.uniforms.h.value = blur * 1 / 256;\n    gl.setRenderTarget(renderTargetBlur);\n    gl.render(blurPlane, shadowCamera.current);\n    blurPlane.material = verticalBlurMaterial;\n    verticalBlurMaterial.uniforms.tDiffuse.value = renderTargetBlur.texture;\n    verticalBlurMaterial.uniforms.v.value = blur * 1 / 256;\n    gl.setRenderTarget(renderTarget);\n    gl.render(blurPlane, shadowCamera.current);\n    blurPlane.visible = false;\n  };\n\n  let count = 0;\n  useFrame(() => {\n    if (shadowCamera.current && (frames === Infinity || count < frames)) {\n      const initialBackground = scene.background;\n      scene.background = null;\n      const initialOverrideMaterial = scene.overrideMaterial;\n      scene.overrideMaterial = depthMaterial;\n      gl.setRenderTarget(renderTarget);\n      gl.render(scene, shadowCamera.current);\n      scene.overrideMaterial = initialOverrideMaterial;\n      blurShadows(blur);\n      if (smooth) blurShadows(blur * 0.4);\n      gl.setRenderTarget(null);\n      scene.background = initialBackground;\n      count++;\n    }\n  });\n  return /*#__PURE__*/React.createElement(\"group\", _extends({\n    \"rotation-x\": Math.PI / 2\n  }, props, {\n    ref: ref\n  }), /*#__PURE__*/React.createElement(\"mesh\", {\n    renderOrder: renderOrder,\n    geometry: planeGeometry,\n    scale: [1, -1, 1],\n    rotation: [-Math.PI / 2, 0, 0]\n  }, /*#__PURE__*/React.createElement(\"meshBasicMaterial\", {\n    map: renderTarget.texture,\n    \"map-encoding\": gl.outputEncoding,\n    transparent: true,\n    opacity: opacity,\n    depthWrite: depthWrite\n  })), /*#__PURE__*/React.createElement(\"orthographicCamera\", {\n    ref: shadowCamera,\n    args: [-width / 2, width / 2, height / 2, -height / 2, 0, far]\n  }));\n});\n\nexport { ContactShadows };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}