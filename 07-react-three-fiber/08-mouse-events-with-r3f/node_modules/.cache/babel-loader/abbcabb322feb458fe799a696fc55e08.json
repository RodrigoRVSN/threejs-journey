{"ast":null,"code":"import { Vector2, Group, Raycaster, Matrix4 } from 'three';\n\nconst _pointer = new Vector2();\n\nconst _event = {\n  type: '',\n  data: _pointer\n};\n\nclass InteractiveGroup extends Group {\n  constructor(renderer, camera) {\n    super();\n    const scope = this;\n    const raycaster = new Raycaster();\n    const tempMatrix = new Matrix4(); // Pointer Events\n\n    const element = renderer.domElement;\n\n    function onPointerEvent(event) {\n      event.stopPropagation();\n      _pointer.x = event.clientX / element.clientWidth * 2 - 1;\n      _pointer.y = -(event.clientY / element.clientHeight) * 2 + 1;\n      raycaster.setFromCamera(_pointer, camera);\n      const intersects = raycaster.intersectObjects(scope.children, false);\n\n      if (intersects.length > 0) {\n        const intersection = intersects[0];\n        const object = intersection.object;\n        const uv = intersection.uv;\n        _event.type = event.type;\n\n        _event.data.set(uv.x, 1 - uv.y);\n\n        object.dispatchEvent(_event);\n      }\n    }\n\n    element.addEventListener('pointerdown', onPointerEvent);\n    element.addEventListener('pointerup', onPointerEvent);\n    element.addEventListener('pointermove', onPointerEvent);\n    element.addEventListener('mousedown', onPointerEvent);\n    element.addEventListener('mouseup', onPointerEvent);\n    element.addEventListener('mousemove', onPointerEvent);\n    element.addEventListener('click', onPointerEvent); // WebXR Controller Events\n    // TODO: Dispatch pointerevents too\n\n    const events = {\n      move: 'mousemove',\n      select: 'click',\n      selectstart: 'mousedown',\n      selectend: 'mouseup'\n    };\n\n    function onXRControllerEvent(event) {\n      const controller = event.target;\n      tempMatrix.identity().extractRotation(controller.matrixWorld);\n      raycaster.ray.origin.setFromMatrixPosition(controller.matrixWorld);\n      raycaster.ray.direction.set(0, 0, -1).applyMatrix4(tempMatrix);\n      const intersections = raycaster.intersectObjects(scope.children, false);\n\n      if (intersections.length > 0) {\n        const intersection = intersections[0];\n        const object = intersection.object;\n        const uv = intersection.uv;\n        _event.type = events[event.type];\n\n        _event.data.set(uv.x, 1 - uv.y);\n\n        object.dispatchEvent(_event);\n      }\n    }\n\n    const controller1 = renderer.xr.getController(0);\n    controller1.addEventListener('move', onXRControllerEvent);\n    controller1.addEventListener('select', onXRControllerEvent);\n    controller1.addEventListener('selectstart', onXRControllerEvent);\n    controller1.addEventListener('selectend', onXRControllerEvent);\n    const controller2 = renderer.xr.getController(1);\n    controller2.addEventListener('move', onXRControllerEvent);\n    controller2.addEventListener('select', onXRControllerEvent);\n    controller2.addEventListener('selectstart', onXRControllerEvent);\n    controller2.addEventListener('selectend', onXRControllerEvent);\n  }\n\n}\n\nexport { InteractiveGroup };","map":{"version":3,"names":["Vector2","Group","Raycaster","Matrix4","_pointer","_event","type","data","InteractiveGroup","constructor","renderer","camera","scope","raycaster","tempMatrix","element","domElement","onPointerEvent","event","stopPropagation","x","clientX","clientWidth","y","clientY","clientHeight","setFromCamera","intersects","intersectObjects","children","length","intersection","object","uv","set","dispatchEvent","addEventListener","events","move","select","selectstart","selectend","onXRControllerEvent","controller","target","identity","extractRotation","matrixWorld","ray","origin","setFromMatrixPosition","direction","applyMatrix4","intersections","controller1","xr","getController","controller2"],"sources":["/home/rodrigorvsn/workspace/study/threejs-journey/07-react-three-fiber/08-mouse-events-with-r3f/node_modules/three-stdlib/interactive/InteractiveGroup.js"],"sourcesContent":["import { Vector2, Group, Raycaster, Matrix4 } from 'three';\n\nconst _pointer = new Vector2();\n\nconst _event = {\n  type: '',\n  data: _pointer\n};\n\nclass InteractiveGroup extends Group {\n  constructor(renderer, camera) {\n    super();\n    const scope = this;\n    const raycaster = new Raycaster();\n    const tempMatrix = new Matrix4(); // Pointer Events\n\n    const element = renderer.domElement;\n\n    function onPointerEvent(event) {\n      event.stopPropagation();\n      _pointer.x = event.clientX / element.clientWidth * 2 - 1;\n      _pointer.y = -(event.clientY / element.clientHeight) * 2 + 1;\n      raycaster.setFromCamera(_pointer, camera);\n      const intersects = raycaster.intersectObjects(scope.children, false);\n\n      if (intersects.length > 0) {\n        const intersection = intersects[0];\n        const object = intersection.object;\n        const uv = intersection.uv;\n        _event.type = event.type;\n\n        _event.data.set(uv.x, 1 - uv.y);\n\n        object.dispatchEvent(_event);\n      }\n    }\n\n    element.addEventListener('pointerdown', onPointerEvent);\n    element.addEventListener('pointerup', onPointerEvent);\n    element.addEventListener('pointermove', onPointerEvent);\n    element.addEventListener('mousedown', onPointerEvent);\n    element.addEventListener('mouseup', onPointerEvent);\n    element.addEventListener('mousemove', onPointerEvent);\n    element.addEventListener('click', onPointerEvent); // WebXR Controller Events\n    // TODO: Dispatch pointerevents too\n\n    const events = {\n      move: 'mousemove',\n      select: 'click',\n      selectstart: 'mousedown',\n      selectend: 'mouseup'\n    };\n\n    function onXRControllerEvent(event) {\n      const controller = event.target;\n      tempMatrix.identity().extractRotation(controller.matrixWorld);\n      raycaster.ray.origin.setFromMatrixPosition(controller.matrixWorld);\n      raycaster.ray.direction.set(0, 0, -1).applyMatrix4(tempMatrix);\n      const intersections = raycaster.intersectObjects(scope.children, false);\n\n      if (intersections.length > 0) {\n        const intersection = intersections[0];\n        const object = intersection.object;\n        const uv = intersection.uv;\n        _event.type = events[event.type];\n\n        _event.data.set(uv.x, 1 - uv.y);\n\n        object.dispatchEvent(_event);\n      }\n    }\n\n    const controller1 = renderer.xr.getController(0);\n    controller1.addEventListener('move', onXRControllerEvent);\n    controller1.addEventListener('select', onXRControllerEvent);\n    controller1.addEventListener('selectstart', onXRControllerEvent);\n    controller1.addEventListener('selectend', onXRControllerEvent);\n    const controller2 = renderer.xr.getController(1);\n    controller2.addEventListener('move', onXRControllerEvent);\n    controller2.addEventListener('select', onXRControllerEvent);\n    controller2.addEventListener('selectstart', onXRControllerEvent);\n    controller2.addEventListener('selectend', onXRControllerEvent);\n  }\n\n}\n\nexport { InteractiveGroup };\n"],"mappings":"AAAA,SAASA,OAAT,EAAkBC,KAAlB,EAAyBC,SAAzB,EAAoCC,OAApC,QAAmD,OAAnD;;AAEA,MAAMC,QAAQ,GAAG,IAAIJ,OAAJ,EAAjB;;AAEA,MAAMK,MAAM,GAAG;EACbC,IAAI,EAAE,EADO;EAEbC,IAAI,EAAEH;AAFO,CAAf;;AAKA,MAAMI,gBAAN,SAA+BP,KAA/B,CAAqC;EACnCQ,WAAW,CAACC,QAAD,EAAWC,MAAX,EAAmB;IAC5B;IACA,MAAMC,KAAK,GAAG,IAAd;IACA,MAAMC,SAAS,GAAG,IAAIX,SAAJ,EAAlB;IACA,MAAMY,UAAU,GAAG,IAAIX,OAAJ,EAAnB,CAJ4B,CAIM;;IAElC,MAAMY,OAAO,GAAGL,QAAQ,CAACM,UAAzB;;IAEA,SAASC,cAAT,CAAwBC,KAAxB,EAA+B;MAC7BA,KAAK,CAACC,eAAN;MACAf,QAAQ,CAACgB,CAAT,GAAaF,KAAK,CAACG,OAAN,GAAgBN,OAAO,CAACO,WAAxB,GAAsC,CAAtC,GAA0C,CAAvD;MACAlB,QAAQ,CAACmB,CAAT,GAAa,EAAEL,KAAK,CAACM,OAAN,GAAgBT,OAAO,CAACU,YAA1B,IAA0C,CAA1C,GAA8C,CAA3D;MACAZ,SAAS,CAACa,aAAV,CAAwBtB,QAAxB,EAAkCO,MAAlC;MACA,MAAMgB,UAAU,GAAGd,SAAS,CAACe,gBAAV,CAA2BhB,KAAK,CAACiB,QAAjC,EAA2C,KAA3C,CAAnB;;MAEA,IAAIF,UAAU,CAACG,MAAX,GAAoB,CAAxB,EAA2B;QACzB,MAAMC,YAAY,GAAGJ,UAAU,CAAC,CAAD,CAA/B;QACA,MAAMK,MAAM,GAAGD,YAAY,CAACC,MAA5B;QACA,MAAMC,EAAE,GAAGF,YAAY,CAACE,EAAxB;QACA5B,MAAM,CAACC,IAAP,GAAcY,KAAK,CAACZ,IAApB;;QAEAD,MAAM,CAACE,IAAP,CAAY2B,GAAZ,CAAgBD,EAAE,CAACb,CAAnB,EAAsB,IAAIa,EAAE,CAACV,CAA7B;;QAEAS,MAAM,CAACG,aAAP,CAAqB9B,MAArB;MACD;IACF;;IAEDU,OAAO,CAACqB,gBAAR,CAAyB,aAAzB,EAAwCnB,cAAxC;IACAF,OAAO,CAACqB,gBAAR,CAAyB,WAAzB,EAAsCnB,cAAtC;IACAF,OAAO,CAACqB,gBAAR,CAAyB,aAAzB,EAAwCnB,cAAxC;IACAF,OAAO,CAACqB,gBAAR,CAAyB,WAAzB,EAAsCnB,cAAtC;IACAF,OAAO,CAACqB,gBAAR,CAAyB,SAAzB,EAAoCnB,cAApC;IACAF,OAAO,CAACqB,gBAAR,CAAyB,WAAzB,EAAsCnB,cAAtC;IACAF,OAAO,CAACqB,gBAAR,CAAyB,OAAzB,EAAkCnB,cAAlC,EAjC4B,CAiCuB;IACnD;;IAEA,MAAMoB,MAAM,GAAG;MACbC,IAAI,EAAE,WADO;MAEbC,MAAM,EAAE,OAFK;MAGbC,WAAW,EAAE,WAHA;MAIbC,SAAS,EAAE;IAJE,CAAf;;IAOA,SAASC,mBAAT,CAA6BxB,KAA7B,EAAoC;MAClC,MAAMyB,UAAU,GAAGzB,KAAK,CAAC0B,MAAzB;MACA9B,UAAU,CAAC+B,QAAX,GAAsBC,eAAtB,CAAsCH,UAAU,CAACI,WAAjD;MACAlC,SAAS,CAACmC,GAAV,CAAcC,MAAd,CAAqBC,qBAArB,CAA2CP,UAAU,CAACI,WAAtD;MACAlC,SAAS,CAACmC,GAAV,CAAcG,SAAd,CAAwBjB,GAAxB,CAA4B,CAA5B,EAA+B,CAA/B,EAAkC,CAAC,CAAnC,EAAsCkB,YAAtC,CAAmDtC,UAAnD;MACA,MAAMuC,aAAa,GAAGxC,SAAS,CAACe,gBAAV,CAA2BhB,KAAK,CAACiB,QAAjC,EAA2C,KAA3C,CAAtB;;MAEA,IAAIwB,aAAa,CAACvB,MAAd,GAAuB,CAA3B,EAA8B;QAC5B,MAAMC,YAAY,GAAGsB,aAAa,CAAC,CAAD,CAAlC;QACA,MAAMrB,MAAM,GAAGD,YAAY,CAACC,MAA5B;QACA,MAAMC,EAAE,GAAGF,YAAY,CAACE,EAAxB;QACA5B,MAAM,CAACC,IAAP,GAAc+B,MAAM,CAACnB,KAAK,CAACZ,IAAP,CAApB;;QAEAD,MAAM,CAACE,IAAP,CAAY2B,GAAZ,CAAgBD,EAAE,CAACb,CAAnB,EAAsB,IAAIa,EAAE,CAACV,CAA7B;;QAEAS,MAAM,CAACG,aAAP,CAAqB9B,MAArB;MACD;IACF;;IAED,MAAMiD,WAAW,GAAG5C,QAAQ,CAAC6C,EAAT,CAAYC,aAAZ,CAA0B,CAA1B,CAApB;IACAF,WAAW,CAAClB,gBAAZ,CAA6B,MAA7B,EAAqCM,mBAArC;IACAY,WAAW,CAAClB,gBAAZ,CAA6B,QAA7B,EAAuCM,mBAAvC;IACAY,WAAW,CAAClB,gBAAZ,CAA6B,aAA7B,EAA4CM,mBAA5C;IACAY,WAAW,CAAClB,gBAAZ,CAA6B,WAA7B,EAA0CM,mBAA1C;IACA,MAAMe,WAAW,GAAG/C,QAAQ,CAAC6C,EAAT,CAAYC,aAAZ,CAA0B,CAA1B,CAApB;IACAC,WAAW,CAACrB,gBAAZ,CAA6B,MAA7B,EAAqCM,mBAArC;IACAe,WAAW,CAACrB,gBAAZ,CAA6B,QAA7B,EAAuCM,mBAAvC;IACAe,WAAW,CAACrB,gBAAZ,CAA6B,aAA7B,EAA4CM,mBAA5C;IACAe,WAAW,CAACrB,gBAAZ,CAA6B,WAA7B,EAA0CM,mBAA1C;EACD;;AAzEkC;;AA6ErC,SAASlC,gBAAT"},"metadata":{},"sourceType":"module"}