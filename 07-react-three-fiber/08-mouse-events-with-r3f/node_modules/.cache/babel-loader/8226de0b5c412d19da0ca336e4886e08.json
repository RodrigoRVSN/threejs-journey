{"ast":null,"code":"import { useFrame, useThree, createPortal } from '@react-three/fiber';\nimport * as React from 'react';\nimport { Vector3, Object3D, Vector2 } from 'three';\nimport { MeshLineGeometry, MeshLineMaterial } from 'meshline';\nconst defaults = {\n  width: 0.2,\n  length: 1,\n  decay: 1,\n  local: false,\n  stride: 0,\n  interval: 1\n};\n\nconst shiftLeft = function (collection) {\n  let steps = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n  collection.set(collection.subarray(steps));\n  collection.fill(-Infinity, -steps);\n  return collection;\n};\n\nfunction useTrail(target, settings) {\n  const {\n    length,\n    local,\n    decay,\n    interval,\n    stride\n  } = { ...defaults,\n    ...settings\n  };\n  const points = React.useRef();\n  const [worldPosition] = React.useState(() => new Vector3());\n  React.useLayoutEffect(() => {\n    if (target) {\n      points.current = Float32Array.from({\n        length: length * 10 * 3\n      }, (_, i) => target.position.getComponent(i % 3));\n    }\n  }, [length, target]);\n  const prevPosition = React.useRef(new Vector3());\n  const frameCount = React.useRef(0);\n  useFrame(() => {\n    if (!target) return;\n    if (!points.current) return;\n\n    if (frameCount.current === 0) {\n      let newPosition;\n\n      if (local) {\n        newPosition = target.position;\n      } else {\n        target.getWorldPosition(worldPosition);\n        newPosition = worldPosition;\n      }\n\n      const steps = 1 * decay;\n\n      for (let i = 0; i < steps; i++) {\n        if (newPosition.distanceTo(prevPosition.current) < stride) continue;\n        shiftLeft(points.current, 3);\n        points.current.set(newPosition.toArray(), points.current.length - 3);\n      }\n\n      prevPosition.current.copy(newPosition);\n    }\n\n    frameCount.current++;\n    frameCount.current = frameCount.current % interval;\n  });\n  return points;\n}\n\nconst Trail = /*#__PURE__*/React.forwardRef((props, forwardRef) => {\n  const {\n    children\n  } = props;\n  const {\n    width,\n    length,\n    decay,\n    local,\n    stride,\n    interval\n  } = { ...defaults,\n    ...props\n  };\n  const {\n    color = 'hotpink',\n    attenuation,\n    target\n  } = props;\n  const size = useThree(s => s.size);\n  const scene = useThree(s => s.scene);\n  const ref = React.useRef(null);\n  const [anchor, setAnchor] = React.useState(null);\n  const points = useTrail(anchor, {\n    length,\n    decay,\n    local,\n    stride,\n    interval\n  });\n  React.useEffect(() => {\n    const t = (target == null ? void 0 : target.current) || ref.current.children.find(o => {\n      return o instanceof Object3D;\n    });\n\n    if (t) {\n      setAnchor(t);\n    }\n  }, [points, target]);\n  const geo = React.useMemo(() => new MeshLineGeometry(), []);\n  const mat = React.useMemo(() => {\n    var _matOverride;\n\n    const m = new MeshLineMaterial({\n      lineWidth: 0.1 * width,\n      color: color,\n      sizeAttenuation: 1,\n      resolution: new Vector2(size.width, size.height)\n    }); // Get and apply first <meshLineMaterial /> from children\n\n    let matOverride;\n\n    if (children) {\n      if (Array.isArray(children)) {\n        matOverride = children.find(child => {\n          const c = child;\n          return typeof c.type === 'string' && c.type === 'meshLineMaterial';\n        });\n      } else {\n        const c = children;\n\n        if (typeof c.type === 'string' && c.type === 'meshLineMaterial') {\n          matOverride = c;\n        }\n      }\n    }\n\n    if (typeof ((_matOverride = matOverride) == null ? void 0 : _matOverride.props) === 'object') {\n      m.setValues(matOverride.props);\n    }\n\n    return m;\n  }, [width, color, size, children]);\n  React.useEffect(() => {\n    mat.uniforms.resolution.value.set(size.width, size.height);\n  }, [size]);\n  useFrame(() => {\n    if (!points.current) return;\n    geo.setPoints(points.current, attenuation);\n  });\n  return /*#__PURE__*/React.createElement(\"group\", null, createPortal( /*#__PURE__*/React.createElement(\"mesh\", {\n    ref: forwardRef,\n    geometry: geo,\n    material: mat\n  }), scene), /*#__PURE__*/React.createElement(\"group\", {\n    ref: ref\n  }, children));\n});\nexport { Trail, useTrail };","map":{"version":3,"names":["useFrame","useThree","createPortal","React","Vector3","Object3D","Vector2","MeshLineGeometry","MeshLineMaterial","defaults","width","length","decay","local","stride","interval","shiftLeft","collection","steps","set","subarray","fill","Infinity","useTrail","target","settings","points","useRef","worldPosition","useState","useLayoutEffect","current","Float32Array","from","_","i","position","getComponent","prevPosition","frameCount","newPosition","getWorldPosition","distanceTo","toArray","copy","Trail","forwardRef","props","children","color","attenuation","size","s","scene","ref","anchor","setAnchor","useEffect","t","find","o","geo","useMemo","mat","_matOverride","m","lineWidth","sizeAttenuation","resolution","height","matOverride","Array","isArray","child","c","type","setValues","uniforms","value","setPoints","createElement","geometry","material"],"sources":["/home/rodrigorvsn/workspace/study/threejs-journey/07-react-three-fiber/08-mouse-events-with-r3f/node_modules/@react-three/drei/core/Trail.js"],"sourcesContent":["import { useFrame, useThree, createPortal } from '@react-three/fiber';\nimport * as React from 'react';\nimport { Vector3, Object3D, Vector2 } from 'three';\nimport { MeshLineGeometry, MeshLineMaterial } from 'meshline';\n\nconst defaults = {\n  width: 0.2,\n  length: 1,\n  decay: 1,\n  local: false,\n  stride: 0,\n  interval: 1\n};\n\nconst shiftLeft = (collection, steps = 1) => {\n  collection.set(collection.subarray(steps));\n  collection.fill(-Infinity, -steps);\n  return collection;\n};\n\nfunction useTrail(target, settings) {\n  const {\n    length,\n    local,\n    decay,\n    interval,\n    stride\n  } = { ...defaults,\n    ...settings\n  };\n  const points = React.useRef();\n  const [worldPosition] = React.useState(() => new Vector3());\n  React.useLayoutEffect(() => {\n    if (target) {\n      points.current = Float32Array.from({\n        length: length * 10 * 3\n      }, (_, i) => target.position.getComponent(i % 3));\n    }\n  }, [length, target]);\n  const prevPosition = React.useRef(new Vector3());\n  const frameCount = React.useRef(0);\n  useFrame(() => {\n    if (!target) return;\n    if (!points.current) return;\n\n    if (frameCount.current === 0) {\n      let newPosition;\n\n      if (local) {\n        newPosition = target.position;\n      } else {\n        target.getWorldPosition(worldPosition);\n        newPosition = worldPosition;\n      }\n\n      const steps = 1 * decay;\n\n      for (let i = 0; i < steps; i++) {\n        if (newPosition.distanceTo(prevPosition.current) < stride) continue;\n        shiftLeft(points.current, 3);\n        points.current.set(newPosition.toArray(), points.current.length - 3);\n      }\n\n      prevPosition.current.copy(newPosition);\n    }\n\n    frameCount.current++;\n    frameCount.current = frameCount.current % interval;\n  });\n  return points;\n}\nconst Trail = /*#__PURE__*/React.forwardRef((props, forwardRef) => {\n  const {\n    children\n  } = props;\n  const {\n    width,\n    length,\n    decay,\n    local,\n    stride,\n    interval\n  } = { ...defaults,\n    ...props\n  };\n  const {\n    color = 'hotpink',\n    attenuation,\n    target\n  } = props;\n  const size = useThree(s => s.size);\n  const scene = useThree(s => s.scene);\n  const ref = React.useRef(null);\n  const [anchor, setAnchor] = React.useState(null);\n  const points = useTrail(anchor, {\n    length,\n    decay,\n    local,\n    stride,\n    interval\n  });\n  React.useEffect(() => {\n    const t = (target == null ? void 0 : target.current) || ref.current.children.find(o => {\n      return o instanceof Object3D;\n    });\n\n    if (t) {\n      setAnchor(t);\n    }\n  }, [points, target]);\n  const geo = React.useMemo(() => new MeshLineGeometry(), []);\n  const mat = React.useMemo(() => {\n    var _matOverride;\n\n    const m = new MeshLineMaterial({\n      lineWidth: 0.1 * width,\n      color: color,\n      sizeAttenuation: 1,\n      resolution: new Vector2(size.width, size.height)\n    }); // Get and apply first <meshLineMaterial /> from children\n\n    let matOverride;\n\n    if (children) {\n      if (Array.isArray(children)) {\n        matOverride = children.find(child => {\n          const c = child;\n          return typeof c.type === 'string' && c.type === 'meshLineMaterial';\n        });\n      } else {\n        const c = children;\n\n        if (typeof c.type === 'string' && c.type === 'meshLineMaterial') {\n          matOverride = c;\n        }\n      }\n    }\n\n    if (typeof ((_matOverride = matOverride) == null ? void 0 : _matOverride.props) === 'object') {\n      m.setValues(matOverride.props);\n    }\n\n    return m;\n  }, [width, color, size, children]);\n  React.useEffect(() => {\n    mat.uniforms.resolution.value.set(size.width, size.height);\n  }, [size]);\n  useFrame(() => {\n    if (!points.current) return;\n    geo.setPoints(points.current, attenuation);\n  });\n  return /*#__PURE__*/React.createElement(\"group\", null, createPortal( /*#__PURE__*/React.createElement(\"mesh\", {\n    ref: forwardRef,\n    geometry: geo,\n    material: mat\n  }), scene), /*#__PURE__*/React.createElement(\"group\", {\n    ref: ref\n  }, children));\n});\n\nexport { Trail, useTrail };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}